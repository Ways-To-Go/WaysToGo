(this.webpackJsonpwaystogo=this.webpackJsonpwaystogo||[]).push([[0],{12:function(e,t,a){},35:function(e,t,a){e.exports=a(60)},40:function(e,t,a){},60:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(17),s=a.n(i),o=(a(40),a(1)),l=a(2),c=a(4),p=a(3),u=a(16),h=(a(12),a(5)),d=a(62),m=a(63),g=a(61),f=a(64),v=a(32),y=a(14),w=a.n(y),E=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={showLogin:!1,showRegister:!1,email:"",password:"",password2:"",firstname:"",lastname:"",registerSuccess:"",registerMessage:""},e.showLogin=function(t){e.setState({showLogin:!e.state.showLogin,showRegister:!1})},e.showRegister=function(t){e.setState({showRegister:!e.state.showRegister,showLogin:!1})},e.onChange=function(t){e.setState(Object(v.a)({},t.target.name,t.target.value))},e.onSubmitLogin=function(t){t.preventDefault(),console.log("Login attempt");w.a.post("https://wtg.aymerik-diebold.fr/login_check",{username:e.state.email,password:e.state.password},{headers:{"Content-Type":"application/json"}}).then((function(t){console.log(t),e.props.connect(t.data.token),e.setState({showLogin:!1}),w.a.get("https://wtg.aymerik-diebold.fr/api/me",{headers:{Authorization:"Bearer "+t.data.token}}).then((function(e){console.log(e),(new u.a).set("id",e.data.id,{path:"/"})})).catch((function(e){throw console.log("Error when retrieve user id"),e}))})).catch((function(t){throw console.log("Login failed"),e.setState({registerSuccess:"Email/password combination not found :("}),t}))},e.onSubmitRegister=function(t){t.preventDefault(),console.log("Register attempt");e.state.password!==e.state.password2?e.setState({registerMessage:"Your passwords do not match :("}):""===e.state.email||""===e.state.password||""===e.state.password2?e.setState({registerMessage:"Email and Password are required"}):w.a.post("https://wtg.aymerik-diebold.fr/register",{email:e.state.email,password:e.state.password,firstname:e.state.firstname,lastname:e.state.lastname},{headers:{"Content-Type":"application/json"}}).then((function(t){!0===t.data.success?(console.log("Registration successful!"),e.setState({registerSuccess:"Your account has been created! You can now log in",email:"",password:"",password2:"",firstname:"",lastname:"",showRegister:!1,showLogin:!0})):(console.log("Registration failed :("),e.setState({registerMessage:"This email address is already registered"}))})).catch((function(e){throw console.log("error"),e}))},e.getStyleLogin=function(){return{display:e.state.showLogin?"block":"none"}},e.getStyleRegister=function(){return{display:e.state.showRegister?"block":"none"}},e}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{class:"topnav"},0==this.props.active?r.a.createElement("a",{class:"active",href:"/WaysToGo/"},"WaysToGo"):r.a.createElement("a",{href:"/WaysToGo/"},"WaysToGo"),3==this.props.active?r.a.createElement("a",{class:"active",href:"?show=about"},"About"):r.a.createElement("a",{href:"?show=about"},"About"),this.props.connected?r.a.createElement("a",{class:1==this.props.active?"active":"",href:"?show=save"},"Add a Trip"):r.a.createElement("span",null),this.props.connected?r.a.createElement("a",{class:4==this.props.active?"active":"",href:"?show=profile"},"Profile"):r.a.createElement("div",null,r.a.createElement("a",{class:"connection",onClick:this.showLogin},"Login"),r.a.createElement("a",{class:"connection",onClick:this.showRegister},"Register")),this.props.connected?r.a.createElement("a",{href:"?logout=true"},"Logout"):r.a.createElement("span",null),5==this.props.active?r.a.createElement("a",{class:"active",href:"?show=research"}," ","Recherche"," "):r.a.createElement("a",{href:"?show=research"},"Recherche"),r.a.createElement("div",{id:"login",style:this.getStyleLogin()},r.a.createElement("p",null,this.state.registerSuccess),r.a.createElement("p",null,"Email"),r.a.createElement("input",{type:"text",name:"email",onChange:this.onChange,value:this.state.email,placeholder:"john.doe@mail.com"}),r.a.createElement("p",null,"Password"),r.a.createElement("input",{type:"password",name:"password",onChange:this.onChange,value:this.state.password}),r.a.createElement("input",{type:"submit",name:"submit",value:"Login",onClick:this.onSubmitLogin})),r.a.createElement("div",{id:"register",style:this.getStyleRegister()},r.a.createElement("p",null,this.state.registerMessage),r.a.createElement("p",null,"Email"),r.a.createElement("input",{type:"text",name:"email",onChange:this.onChange,value:this.state.email,placeholder:"ex. john.doe@mail.com"}),r.a.createElement("p",null,"Firstname"),r.a.createElement("input",{type:"text",name:"firstname",onChange:this.onChange,value:this.state.firstname,placeholder:"ex. John"}),r.a.createElement("p",null,"Lastname"),r.a.createElement("input",{type:"text",name:"lastname",onChange:this.onChange,value:this.state.lastname,placeholder:"ex. Doe"}),r.a.createElement("p",null,"Password"),r.a.createElement("input",{type:"password",name:"password",onChange:this.onChange,value:this.state.password}),r.a.createElement("p",null,"Confirm Password"),r.a.createElement("input",{type:"password",name:"password2",onChange:this.onChange,value:this.state.password2}),r.a.createElement("input",{type:"submit",name:"submit",value:"Login",onClick:this.onSubmitRegister})))}}]),a}(n.Component),b=a(15),k=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={files:e.files,filesToShow:[]},n.handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"handleChange",value:function(e){this.props.changeButtonState(!0),this.setState({filesToShow:[].concat(Object(b.a)(this.state.filesToShow),Object(b.a)(e.target.files))});var t=this,a=0,n=e.target.files;Object(b.a)(e.target.files).map((function(e){var r=new XMLHttpRequest,i=e;r.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&201===this.status&&(console.log("Upload photo in API : success"),t.props.addImgFile({image:i,image_URL_BDD:"/api/photos/"+JSON.parse(this.responseText).id}),(a+=1)==n.length&&t.props.changeButtonState(!1))},e.open("POST","https://wtg.aymerik-diebold.fr/api/photos",!0),e.setRequestHeader("Authorization","Bearer "+t.props.token),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify({path:JSON.parse(this.responseText).data.link,isCover:!1}))}},r.open("POST","https://api.imgur.com/3/image",!0),r.setRequestHeader("Authorization","Client-ID 140f137c33f88ac");var s=new FormData;s.append("image",e),r.send(s)}))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{ref:this.props.imgcontainer},this.state.filesToShow&&Object(b.a)(this.state.filesToShow).map((function(e,t){return r.a.createElement("img",{key:t,width:"200px",height:"200px",src:URL.createObjectURL(e),alt:"Image"})}))),r.a.createElement("input",{id:this.props.uploadID,style:{display:"none"},ref:this.props.refInput,type:"file",accept:"image/*",multiple:!0,onChange:this.handleChange}),r.a.createElement("label",{for:this.props.uploadID,class:"custom-file-upload"},"Add images to this step"))}}]),a}(r.a.Component),D=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).researchRef=r.a.createRef(),n}return Object(l.a)(a,[{key:"hinter",value:function(e){if(this.props.getdataback(0,0),!(e.target.value.length<2)){var t=new XMLHttpRequest,a=this;t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText);a.researchRef.current.innerHTML="",e.forEach((function(e){var t=document.createElement("div");t.innerText=e.display_name,t.onclick=function(){a.props.refCity.current.value=this.innerText,a.props.getdataback(parseFloat(e.lat),parseFloat(e.lon)),a.researchRef.current.innerHTML=""},a.researchRef.current.appendChild(t)}))}},t.open("GET","https://nominatim.openstreetmap.org/?addressdetails=1&format=json&limit=3&q="+this.props.refCity.current.value,!0),t.send()}}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("input",{ref:this.props.refCity,type:"text",name:"lville",placeholder:"Place..",id:"name_input",onKeyPress:this.hinter.bind(this)}),r.a.createElement("div",{ref:this.researchRef,id:"huge_list"}))}}]),a}(r.a.Component),T=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"deleteTrip",value:function(){if(1==window.confirm("Delete ?")){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&204===this.status&&(window.location=window.location.hostname)},e.open("DELETE","https://wtg.aymerik-diebold.fr/api/trips/"+this.props.id,!0),e.setRequestHeader("Authorization","Bearer "+this.props.token),e.setRequestHeader("Content-Type","application/json"),e.send()}}},{key:"render",value:function(){return r.a.createElement("button",{type:"button",onClick:this.deleteTrip.bind(this)},"Delete step")}}]),a}(n.Component),O=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={files:[],title:e.step.title,city:e.step.city,arrival:e.step.arrival,departure:e.step.departure,description:e.step.description,id:e.step.id,photos:e.step.photos},e.step.departureTransport&&"undefined"!==e.step.departureTransport&&(n.state.departureTransport=e.step.departureTransport.type),n.editFunction=n.editFunction.bind(Object(h.a)(n)),n.getLatLnt=n.getLatLnt.bind(Object(h.a)(n)),n.addImgFile=n.addImgFile.bind(Object(h.a)(n)),n.newCity=r.a.createRef(),n.newName=r.a.createRef(),n.newDate=r.a.createRef(),n.newDateDepart=r.a.createRef(),n.newDepartureTransport=r.a.createRef(),n.newDescription=r.a.createRef(),n.newLat=r.a.createRef(),n.newLnt=r.a.createRef(),n.boutonOK=r.a.createRef(),n.modal=r.a.createRef(),n.refHead=r.a.createRef(),n.imgcontainer=r.a.createRef(),n.inputphotoToReset=r.a.createRef(),n.toggleModal=n.toggleModal.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"editFunction",value:function(){var e=[];e=this.state.files.length>0?this.state.files:this.props.photos;var t=new XMLHttpRequest,a=this;t.onreadystatechange=function(){console.log(this.responseText);var e=this.responseText;if(4===this.readyState&&200===this.status){var t=new XMLHttpRequest;t.onreadystatechange=function(){console.log(this.responseText),4===this.readyState&&200===this.status&&(a.toggleModal(),document.location.reload(!0))},t.open("PATCH","https://wtg.aymerik-diebold.fr"+JSON.parse(e).departureTransport,!0),t.setRequestHeader("Authorization","Bearer "+a.props.token),t.setRequestHeader("Content-Type","application/merge-patch+json"),t.send(JSON.stringify({stageFrom:"/api/stages/"+JSON.parse(e).id,type:a.newDepartureTransport.current.value,distance:0}))}},t.open("PATCH","https://wtg.aymerik-diebold.fr/api/stages/"+this.state.id,!0),t.setRequestHeader("Authorization","Bearer "+this.props.token),t.setRequestHeader("Content-Type","application/merge-patch+json"),t.send(JSON.stringify({city:this.newCity.current.value,country:"rien",mark:0,description:this.newDescription.current.value,arrival:this.newDate.current.value,departure:this.newDateDepart.current.value,lng:this.state.newLat,lat:this.state.newLnt,title:this.newName.current.value,photos:e}))}},{key:"deleteFunction",value:function(){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){console.log(this.responseText),4===this.readyState&&204===this.status&&(t.toggleModal(),document.location.reload(!0))},e.open("DELETE","https://wtg.aymerik-diebold.fr/api/stages/"+this.state.id,!0),e.setRequestHeader("Authorization","Bearer "+this.props.token),e.setRequestHeader("Content-Type","application/json"),e.send()}},{key:"getLatLnt",value:function(e,t){this.setState({newLnt:t,newLat:e})}},{key:"addImgFile",value:function(e){this.state.files.push(e.image_URL_BDD)}},{key:"changeButtonState",value:function(e){this.boutonOK.current.disabled=e,this.boutonOK.current.textContent=!0===e?"Image upload in progress...":"Add step"}},{key:"toggleModal",value:function(){this.newName.current.value=this.state.title,this.newCity.current.value=this.state.city,this.newDate.current.value=this.state.arrival,this.newDateDepart.current.value=this.state.departure,this.newDepartureTransport.current.value=this.state.departureTransport,this.newDescription.current.value=this.state.description,this.modal.current.classList.toggle("show-modal")}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{ref:this.modal,class:"modal2"},r.a.createElement("div",{class:"modal-content"},r.a.createElement("span",{class:"close-button",onClick:this.toggleModal},"\xd7"),r.a.createElement("label",{for:"lville"},"Location"),r.a.createElement(D,{refCity:this.newCity,getdataback:this.getLatLnt,newLat:this.newLat,newLnt:this.newLnt}),r.a.createElement("label",{for:"nometape"},"Step name"),r.a.createElement("input",{ref:this.newName,type:"text",id:"nometape",name:"nometape",placeholder:"ex. visit of the Eiffel tower"}),r.a.createElement("label",{for:"larrivee"},"Arrival date"),r.a.createElement("input",{ref:this.newDate,type:"text",id:"larrivee",name:"larrivee",placeholder:"Arrival.. (YYYY-MM-DD)"}),r.a.createElement("label",{for:"ldepart"},"Departure date"),r.a.createElement("input",{ref:this.newDateDepart,type:"text",id:"ldepart",name:"ldepart",placeholder:"Departure.. (YYYY-MM-DD)"}),r.a.createElement("label",{for:"ltransport"},"Moyen de transport entre \xe9tapes"),r.a.createElement("input",{ref:this.newDepartureTransport,type:"text",id:"ltransport",name:"ltransport",placeholder:"Train, car, tuk-tuk, on foot .."}),r.a.createElement("label",{for:"ldescription"},"Your story"),r.a.createElement("textarea",{ref:this.newDescription,id:"ldescription",name:"ldescription",placeholder:"What you want.."}),r.a.createElement(k,{key:"addStep"+this.props.stepKey,uploadID:"editStep"+this.props.stepKey,token:this.props.token,addImgFile:this.addImgFile,files:this.state.files,changeButtonState:this.changeButtonState.bind(this),imgcontainer:this.imgcontainer,refInput:this.inputphotoToReset}),r.a.createElement("button",{type:"button",ref:this.boutonOK,onClick:this.editFunction.bind(this)},"Edit step"),r.a.createElement("button",{type:"button",ref:this.boutonDelete,onClick:this.deleteFunction.bind(this)},"Delete step"))),r.a.createElement("button",{type:"button",onClick:this.toggleModal},"Edit step"))}}]),a}(n.Component),S=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={files:[]},n.addFunction=n.addFunction.bind(Object(h.a)(n)),n.getLatLnt=n.getLatLnt.bind(Object(h.a)(n)),n.addImgFile=n.addImgFile.bind(Object(h.a)(n)),n.toggleModal=n.toggleModal.bind(Object(h.a)(n)),n.newCity=r.a.createRef(),n.newName=r.a.createRef(),n.newDate=r.a.createRef(),n.newDateDepart=r.a.createRef(),n.newDepartureTransport=r.a.createRef(),n.newDescription=r.a.createRef(),n.newLat=r.a.createRef(),n.newLnt=r.a.createRef(),n.boutonOK2=r.a.createRef(),n.modal=r.a.createRef(),n.imgcontainer2=r.a.createRef(),n.inputphotoToReset=r.a.createRef(),n}return Object(l.a)(a,[{key:"addFunction",value:function(){if(""!=this.newName.current.value&&""!=this.newDate.current.value&&""!=this.newDateDepart.current.value&&""!=this.newCity.current.value){var e=[];e=this.state.files.length>0?this.state.files:this.props.photos;var t=new XMLHttpRequest,a=this;t.onreadystatechange=function(){console.log(this.responseText);var e=this.responseText;if(4===this.readyState&&201===this.status){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&201===this.status&&(a.toggleModal(),document.location.reload(!0))},t.open("POST","https://wtg.aymerik-diebold.fr/api/transports",!0),t.setRequestHeader("Authorization","Bearer "+a.props.token),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({stageFrom:"/api/stages/"+JSON.parse(e).id,type:a.newDepartureTransport.current.value,distance:0}))}},t.open("POST","https://wtg.aymerik-diebold.fr/api/stages",!0),t.setRequestHeader("Authorization","Bearer "+this.props.token),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({city:this.newCity.current.value,country:"rien",mark:0,description:this.newDescription.current.value,arrival:this.newDate.current.value,departure:this.newDateDepart.current.value,trip:"/api/trips/"+this.props.tripId,lng:this.state.newLat,lat:this.state.newLnt,title:this.newName.current.value,photos:e}))}else alert("Location, name, arrival and departure date required")}},{key:"getLatLnt",value:function(e,t){this.setState({newLnt:t,newLat:e})}},{key:"addImgFile",value:function(e){this.state.files.push(e.image_URL_BDD)}},{key:"changeButtonState",value:function(e){this.boutonOK2.current.disabled=e,this.boutonOK2.current.textContent=!0===e?"Image upload in progress...":"Add step"}},{key:"toggleModal",value:function(){console.log("toggle modal edit"),this.newName.current.value="",this.newCity.current.value="",this.newDate.current.value="",this.newDateDepart.current.value="",this.newDepartureTransport.current.value="",this.newDescription.current.value="",this.modal.current.classList.toggle("show-modal3")}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{ref:this.modal,class:"modal3"},r.a.createElement("div",{class:"modal-content"},r.a.createElement("h5",null,"Add Step"),r.a.createElement("span",{class:"close-button",onClick:this.toggleModal},"\xd7"),r.a.createElement("label",{for:"lville"},"Location"),r.a.createElement(D,{refCity:this.newCity,getdataback:this.getLatLnt,newLat:this.newLat,newLnt:this.newLnt}),r.a.createElement("label",{for:"nometape"},"Step name"),r.a.createElement("input",{ref:this.newName,type:"text",id:"nometape",name:"nometape",placeholder:"ex. visit of the Eiffel tower"}),r.a.createElement("label",{for:"larrivee"},"Arrival date"),r.a.createElement("input",{ref:this.newDate,type:"text",id:"larrivee",name:"larrivee",placeholder:"Arrival.. (YYYY-MM-DD)"}),r.a.createElement("label",{for:"ldepart"},"Departure date"),r.a.createElement("input",{ref:this.newDateDepart,type:"text",id:"ldepart",name:"ldepart",placeholder:"Departure.. (YYYY-MM-DD)"}),r.a.createElement("label",{for:"ltransport"},"Moyen de transport entre \xe9tapes"),r.a.createElement("input",{ref:this.newDepartureTransport,type:"text",id:"ltransport",name:"ltransport",placeholder:"Train, car, tuk-tuk, on foot .."}),r.a.createElement("label",{for:"ldescription"},"Your story"),r.a.createElement("textarea",{ref:this.newDescription,id:"ldescription",name:"ldescription",placeholder:"What you want.."}),r.a.createElement(k,{key:"addStep"+this.props.stepKey,uploadID:"addStep",token:this.props.token,addImgFile:this.addImgFile,files:this.state.files,changeButtonState:this.changeButtonState.bind(this),imgcontainer:this.imgcontainer2,refInput:this.inputphotoToReset}),r.a.createElement("button",{type:"button",ref:this.boutonOK2,onClick:this.addFunction.bind(this)},"Add step"))),r.a.createElement("button",{type:"button",onClick:this.toggleModal},"Add step"))}}]),a}(n.Component),C=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={param:e.param},n.saveTripButton=r.a.createRef(),n.verifIfTripAlreadySaved=n.verifIfTripAlreadySaved.bind(Object(h.a)(n)),n.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],n}return Object(l.a)(a,[{key:"getStageNumber",value:function(e){return e.length}},{key:"getDateDebut",value:function(e){if(e.length>0){var t=new Date(e[0].departure);return this.monthNames[t.getMonth()]}return null}},{key:"getDateFin",value:function(e){if(e.length>0){var t=new Date(e[e.length-1].arrival);return this.monthNames[t.getMonth()]}return 0}},{key:"getDureeVoyage1",value:function(e){if(e.length>0){var t=new Date(e[e.length-1].arrival)-new Date(e[0].departure);return Math.ceil(t/864e5)+1}return 0}},{key:"getDureeVoyage2",value:function(e,t){var a=new Date(t)-new Date(e);return Math.ceil(a/864e5)+1}},{key:"getMonthsDate1",value:function(e){if(e.length>0){var t=this.getDateDebut(e);return t!==this.getDateFin(e)?this.getDateDebut(e)+" - "+this.getDateFin(e):t}return""}},{key:"getMonthsDate2",value:function(e,t){var a=new Date(e),n=new Date(t);return a.getMonth()!==n.getMonth()?this.monthNames[a.getMonth()]+" - "+this.monthNames[n.getMonth()]:this.monthNames[a.getMonth()]}},{key:"getCookie",value:function(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;n++){for(var r=a[n];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}},{key:"verifIfTripAlreadySaved",value:function(){if(this.props.connected){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){t.saveTripButton.current.style.visibility="visible";var e=[];JSON.parse(this.responseText).recordedTrips.forEach((function(t){e.push(t["@id"])})),-1===e.indexOf("/api/trips/"+t.props.param.id)?t.saveTripButton.current.innerHTML="Save this trip":t.saveTripButton.current.innerHTML="Trip already saved :) Click to cancel"}},e.open("GET","https://wtg.aymerik-diebold.fr/api/users/"+t.getCookie("id"),!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization","Bearer "+t.props.token),e.send()}}},{key:"componentDidMount",value:function(){this.verifIfTripAlreadySaved()}},{key:"saveTrip",value:function(){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText),a=[];e.recordedTrips.forEach((function(e){a.push(e["@id"])}));var n,r=a.indexOf("/api/trips/"+t.props.param.id);if(-1!==r)r>-1&&a.splice(r,1),(n=new XMLHttpRequest).onreadystatechange=function(){4===this.readyState&&200===this.status&&(t.saveTripButton.current.innerHTML="Save this trip")},n.open("PATCH","https://wtg.aymerik-diebold.fr/api/users/"+t.getCookie("id"),!0),n.setRequestHeader("Content-Type","application/merge-patch+json"),n.setRequestHeader("Authorization","Bearer "+t.props.token),n.send(JSON.stringify({recordedTrips:a}));else(n=new XMLHttpRequest).onreadystatechange=function(){4===this.readyState&&200===this.status&&(t.saveTripButton.current.innerHTML="Trip saved :) Click to cancel")},n.open("PATCH","https://wtg.aymerik-diebold.fr/api/users/"+t.getCookie("id"),!0),n.setRequestHeader("Content-Type","application/merge-patch+json"),n.setRequestHeader("Authorization","Bearer "+t.props.token),a.push("/api/trips/"+t.props.param.id),n.send(JSON.stringify({recordedTrips:a}))}},e.open("GET","https://wtg.aymerik-diebold.fr/api/users/"+this.getCookie("id"),!0),e.setRequestHeader("Content-Type","application/merge-patch+json"),e.setRequestHeader("Authorization","Bearer "+this.props.token),e.send()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{ref:this.state.param.refHead,id:"head"},r.a.createElement("h2",null,this.state.param.title),r.a.createElement("h5",null,this.state.param.startdate?"":this.getMonthsDate1(this.state.param.stages)),r.a.createElement("p",{class:"ladescription"},'"'+this.state.param.description+'"'),r.a.createElement("p",null,this.state.param.vegan?"This trip is vegan":"This trip is non-vegan"),r.a.createElement("p",null,this.state.param.ecological?"This trip is ecological":"This trip is marked as non-ecological"),r.a.createElement("p",null,"auteur :"," ",this.state.param.author.firstName+" "+this.state.param.author.lastName),r.a.createElement("p",null,"Dur\xe9e du voyage :"," ",this.state.param.startdate?this.getDureeVoyage2(this.state.param.startdate,this.state.param.enddate):this.getDureeVoyage1(this.state.param.stages)," ","jours"),this.state.param.edit?r.a.createElement("div",null,r.a.createElement("label",{for:"files2",style:{border:"2px solid black"}},"Change cover image"),r.a.createElement("input",{id:"files2",style:{visibility:"hidden"},ref:this.state.param.refHead,type:"file",accept:"image/*",onChange:this.state.param.changeCover})):r.a.createElement("div",null,this.props.myTrip?r.a.createElement(T,{id:this.state.param.id,token:this.props.token}):"",r.a.createElement("button",{ref:this.saveTripButton,style:{visibility:"hidden"},type:"button",onClick:function(){return e.saveTrip()}},"Save this trip")))}}]),a}(n.Component),R=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{class:"etape"},r.a.createElement("p",{class:"nomEtape"},this.props.etape.description),r.a.createElement("p",{class:"villedate_etape"},this.props.etape.city+" \u2022 "+new Date(this.props.etape.arrival)),this.props.etape.photos.map((function(t,a){return r.a.createElement("div",null,r.a.createElement("img",{key:e.props.editStepKey.toString()+a.toString(),src:t.path,alt:t.title,height:"150",width:"200"}),r.a.createElement("p",{key:a},t.description))})),this.props.myTrip?r.a.createElement(O,{key:this.props.editStepKey.toString+"add",stepKey:this.props.editStepKey,step:this.props.etape,token:this.props.token}):""),this.props.etape.departureTransport?r.a.createElement("div",{class:"transition_etape"},r.a.createElement("p",{class:"transitionTexte"},"\u2022 Moyen de transport : ",this.props.etape.departureTransport.type)):"")}}]),a}(r.a.Component),L=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).loadDoc(Object(h.a)(n)),n.verifTripIsMine(Object(h.a)(n)),n.state={param:!1,myTrip:!1},n}return Object(l.a)(a,[{key:"verifTripIsMine",value:function(){var e=this;w.a.get("https://wtg.aymerik-diebold.fr/api/me",{headers:{Authorization:"Bearer "+this.props.token}}).then((function(t){var a=[];t.data.trips.forEach((function(e){a.push(parseInt(e.id))})),-1!=a.indexOf(parseInt(e.props.id))&&e.setState({myTrip:!0})})).catch((function(e){throw console.log("Error when retrieve user id"),e}))}},{key:"loadDoc",value:function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var t=JSON.parse(this.responseText);e.setState({param:t})}},t.open("GET","https://wtg.aymerik-diebold.fr/api/trips/"+e.props.id,!0),t.send()}},{key:"render",value:function(){var e=this;return this.state.param?r.a.createElement("div",null,r.a.createElement(E,{connected:this.props.connected,connect:this.props.connect}),r.a.createElement("div",{id:"carteSide"},r.a.createElement(d.a,{id:"ShowVoyageMap",center:[40,3],zoom:1},r.a.createElement(m.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),this.state.param.stages.map((function(e){return r.a.createElement(g.a,{position:[e.lng,e.lat]},r.a.createElement(f.a,null,r.a.createElement("h1",null,e.description)))})))),r.a.createElement("div",{id:"information"},r.a.createElement(C,{param:this.state.param,myTrip:this.state.myTrip,token:this.props.token,connect:this.props.connect,connected:this.props.connected}),this.state.myTrip?r.a.createElement(S,{tripId:this.state.param.id,key:"firstAddStep",stepKey:"firstAddStep",token:this.props.token}):console.log("not here"),r.a.createElement("div",{id:"etapes"},this.state.param.stages.map((function(t,a){return r.a.createElement(R,{key:a,tripId:e.state.param.id,etape:t,editStepKey:a,photos:t.photos,myTrip:e.state.myTrip,token:e.props.token})}))))):r.a.createElement("h1",null,"Chargement en cours...")}}]),a}(n.Component),j=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).refLocation=r.a.createRef(),n.refName=r.a.createRef(),n.refDate=r.a.createRef(),n.refDescription=r.a.createRef(),n.refDateDepart=r.a.createRef(),n.refDepartureTransport=r.a.createRef(),n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{class:"etapevoyage"},r.a.createElement("button",{type:"button",onClick:function(){return e.props.editStepLink(e.refName,e.refLocation,e.refDate,e.refDateDepart,e.refDepartureTransport,e.refDescription)}},"Edit step"),r.a.createElement("br",null),r.a.createElement("label",null,"Location : "),r.a.createElement("label",{ref:this.refLocation},this.props.arguments.location),r.a.createElement("br",null),r.a.createElement("label",null,"Step name : "),r.a.createElement("label",{ref:this.refName},this.props.arguments.name),r.a.createElement("br",null),r.a.createElement("label",null,"Arrival date : "),r.a.createElement("label",{ref:this.refDate},this.props.arguments.date),r.a.createElement("br",null),r.a.createElement("label",null,"Departure date : "),r.a.createElement("label",{ref:this.refDateDepart},this.props.arguments.dateDepart),r.a.createElement("br",null),r.a.createElement("label",null,"Moyen de transport : "),r.a.createElement("label",{ref:this.refDepartureTransport},this.props.arguments.departureTransport),r.a.createElement("br",null),r.a.createElement("label",null,"Your story : "),r.a.createElement("label",{ref:this.refDescription},this.props.arguments.description),r.a.createElement("br",null),this.props.arguments.files&&Object(b.a)(this.props.arguments.files).map((function(e,t){return r.a.createElement("img",{key:t,width:"200px",height:"200px",src:URL.createObjectURL(e.image),alt:"Image"})})))}}]),a}(r.a.Component),M=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={name:e.name,description:e.description,vegan:e.vegan,ecolo:e.ecolo,voyageId:e.voyageId,editStepBool:!1,files:[]},n.setTextInputRef=r.a.createRef(),n.inputphotoToReset=r.a.createRef(),n.imgcontainer=r.a.createRef(),n.toggleModal=n.toggleModal.bind(Object(h.a)(n)),n.getLatLnt=n.getLatLnt.bind(Object(h.a)(n)),n.editStep=n.editStep.bind(Object(h.a)(n)),n.changeEnteteBackground=n.changeEnteteBackground.bind(Object(h.a)(n)),n.newCity=r.a.createRef(),n.newName=r.a.createRef(),n.newDate=r.a.createRef(),n.newDateDepart=r.a.createRef(),n.newDepartureTransport=r.a.createRef(),n.newDescription=r.a.createRef(),n.newLat=r.a.createRef(),n.newLnt=r.a.createRef(),n.boutonOK=r.a.createRef(),n.refHead=r.a.createRef(),n}return Object(l.a)(a,[{key:"editStep",value:function(e,t,a,n,r,i){this.newDescription.current.value=this.state.stepDescription,this.newName.current.value=this.state.stepName,this.newDate.current.value=this.state.stepDate,this.newDateDepart.current.value=this.state.stepDateDepart,this.newDepartureTransport.current.value=this.state.stepDepartureTransport,this.newCity.current.value=this.state.stepCity,this.setState({editStepBool:!0,stepDate:a,stepDateDepart:n,stepDepartureTransport:r,refName:e}),document.querySelector(".modal").classList.toggle("show-modal")}},{key:"addEtapeVoyage",value:function(){if(""!=this.newName.current.value&&""!=this.newDate.current.value&&""!=this.newDateDepart.current.value&&""!=this.newCity.current.value){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){var e=this.responseText;if(4===this.readyState&&201===this.status){0==t.state.editStepBool?s.a.render(r.a.createElement(j,{arguments:{location:t.newCity.current.value,files:t.state.files,description:t.newDescription.current.value,date:t.newDate.current.value,dateDepart:t.newDateDepart.current.value,departureTransport:t.newDepartureTransport.current.value,name:t.newName.current.value},editStepLink:t.editStep}),t.setTextInputRef.current.appendChild(document.createElement("div"))):(t.state.refLocation.current.textContent=t.newCity.current.value,t.state.refDate.current.textContent=t.newDate.current.value,t.state.refDateDepart.current.textContent=t.newDateDepart.current.value,t.state.refDepartureTransport.current.textContent=t.newDepartureTransport.current.value,t.state.refDescription.current.textContent=t.newDescription.current.value,t.state.refName.current.textContent=t.newName.current.value);var a=new XMLHttpRequest;a.onreadystatechange=function(){4===this.readyState&&201===this.status&&(t.state.editStepBool=!1,t.toggleModal())},a.open("POST","https://wtg.aymerik-diebold.fr/api/transports",!0),a.setRequestHeader("Authorization","Bearer "+t.props.token),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify({stageFrom:"/api/stages/"+JSON.parse(e).id,type:t.newDepartureTransport.current.value,distance:0}))}},this.setState({stepDescription:this.newDescription.current.value,stepName:this.newName.current.value,stepDate:this.newDate.current.value,stepDateDepart:this.newDateDepart.current.value,stepDepartureTransport:this.newDepartureTransport.current.value,stepId:this.state.voyageId,stepLat:this.state.newLat,stepLnt:this.state.newLnt,stepCity:this.newCity.current.value,stepFiles:this.state.files});var a=[];this.state.files.forEach((function(e){a.push(e.image_URL_BDD)})),e.open("POST","https://wtg.aymerik-diebold.fr/api/stages",!0),e.setRequestHeader("Authorization","Bearer "+this.props.token),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify({city:this.newCity.current.value,country:"rien",mark:0,description:this.newDescription.current.value,arrival:this.newDate.current.value,departure:this.newDateDepart.current.value,trip:"/api/trips/"+this.state.voyageId,lng:this.state.newLat,lat:this.state.newLnt,title:this.newName.current.value,photos:a}))}else alert("Location, name, arrival and departure date required")}},{key:"toggleModal",value:function(){document.querySelector(".modal").classList.toggle("show-modal"),this.newDescription.current.value="",this.newName.current.value="",this.newDate.current.value="",this.newDateDepart.current.value="",this.newDepartureTransport.current.value="",this.newCity.current.value="",this.inputphotoToReset.current.value="",this.imgcontainer.current.textContent="",this.setState({files:[]})}},{key:"changeButtonState",value:function(e){this.boutonOK.current.disabled=e,this.boutonOK.current.textContent=1==e?"Image upload in progress...":"Add step"}},{key:"getLatLnt",value:function(e,t){this.setState({newLnt:t,newLat:e})}},{key:"changeEnteteBackground",value:function(e){this.refHead.current.style.backgroundImage="linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('"+URL.createObjectURL(e.target.files[0])+"')"}},{key:"addImgFile",value:function(e){this.setState({files:this.state.files.concat(e)})}},{key:"render",value:function(){return r.a.createElement("div",{id:"information"},r.a.createElement(C,{param:{changeCover:this.changeEnteteBackground,edit:!0,refHead:this.refHead,title:this.state.name,description:this.state.description,vegan:this.state.vegan,ecolo:this.state.ecolo,stages:[],author:{firstName:"Nicolas",lastName:"Dupond"}}}),r.a.createElement("div",{ref:this.setTextInputRef}),r.a.createElement("div",{class:"modal"},r.a.createElement("div",{class:"modal-content"},r.a.createElement("span",{class:"close-button",onClick:this.toggleModal},"\xd7"),r.a.createElement("label",{for:"lville"},"Location"),r.a.createElement(D,{refCity:this.newCity,getdataback:this.getLatLnt,newLat:this.newLat,newLnt:this.newLnt}),r.a.createElement("label",{for:"nometape"},"Step name"),r.a.createElement("input",{ref:this.newName,type:"text",id:"nometape",name:"nometape",placeholder:"ex. visit of the Eiffel tower"}),r.a.createElement("label",{for:"larrivee"},"Arrival date"),r.a.createElement("input",{ref:this.newDate,type:"text",id:"larrivee",name:"larrivee",placeholder:"Arrival.. (YYYY-MM-DD)"}),r.a.createElement("label",{for:"ldepart"},"Departure date"),r.a.createElement("input",{ref:this.newDateDepart,type:"text",id:"ldepart",name:"ldepart",placeholder:"Departure.. (YYYY-MM-DD)"}),r.a.createElement("label",{for:"ltransport"},"Moyen de transport entre \xe9tapes"),r.a.createElement("input",{ref:this.newDepartureTransport,type:"text",id:"ltransport",name:"ltransport",placeholder:"Train, car, tuk-tuk, on foot .."}),r.a.createElement("label",{for:"ldescription"},"Your story"),r.a.createElement("textarea",{ref:this.newDescription,id:"ldescription",name:"ldescription",placeholder:"What you want.."}),r.a.createElement(k,{token:this.props.token,uploadID:"addVoyage",addImgFile:this.addImgFile.bind(this),files:this.state.files,changeButtonState:this.changeButtonState.bind(this),imgcontainer:this.imgcontainer,refInput:this.inputphotoToReset}),r.a.createElement("button",{type:"button",ref:this.boutonOK,onClick:this.addEtapeVoyage.bind(this)},"Add step"))),r.a.createElement("button",{class:"trigger",onClick:this.toggleModal},"Add a step"))}}]),a}(r.a.Component),N=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("h2",null,"Chargement")}}]),a}(r.a.Component),x=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).description=r.a.createRef(),n.name=r.a.createRef(),n.vegan=r.a.createRef(),n.ecolo=r.a.createRef(),n}return Object(l.a)(a,[{key:"addVoyageCheck",value:function(){this.description.current.validity.valid&&this.name.current.validity.valid?this.props.addMyVoyage(this.name.current.value,this.description.current.value,this.vegan.current.checked,this.ecolo.current.checked):alert("Please complete the Details section")}},{key:"render",value:function(){return r.a.createElement("div",{className:"formulaire"},r.a.createElement("h3",null,"New trip"),r.a.createElement("div",{className:"partie"},r.a.createElement("h4",null,"D\xe9tails"),r.a.createElement("div",{className:"partiedetails"},r.a.createElement("p",{className:"partieLabel"},"Trip name:"),r.a.createElement("input",{required:!0,type:"text",ref:this.name,id:"fname",name:"firstname",placeholder:"ex. A grand tour of France"}),r.a.createElement("p",{className:"partieLabel"},"Trip summary:"),r.a.createElement("textarea",{required:!0,ref:this.description,id:"lname",name:"lastname",placeholder:"ex. A bucolic journey through the French countryside: old relics and local specialities"}))),r.a.createElement("div",{className:"partie"},r.a.createElement("h4",null,"Parameters"),r.a.createElement("div",{className:"partiedetails"},r.a.createElement("div",null,r.a.createElement("input",{ref:this.vegan,type:"checkbox",id:"voyagevegan",name:"voyagevegan",value:"newsletter"}),r.a.createElement("label",{htmlFor:"voyagevegan"},"Is this trip vegan?")),r.a.createElement("div",null,r.a.createElement("input",{ref:this.ecolo,type:"checkbox",id:"voyageecolo",name:"voyageecolo",value:"newsletter"}),r.a.createElement("label",{htmlFor:"voyageecolo"},"Is this trip environmentally friendly?")))),r.a.createElement("button",{type:"button",className:"boutonsend",onClick:this.addVoyageCheck.bind(this)},"Add my trip"))}}]),a}(r.a.Component),A=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={token:e.token,startNewVoyage:!0,chargement:!1,name:"",description:"",vegan:!1,ecolo:!1},n.addMyVoyage=n.addMyVoyage.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"addMyVoyage",value:function(e,t,a,n){this.setState({name:e,description:t,vegan:a,ecolo:n,chargement:!0});var r=new XMLHttpRequest,i=this;r.onreadystatechange=function(){if(4===this.readyState&&201===this.status){var e=JSON.parse(this.responseText);i.setState({chargement:!1,startNewVoyage:!1,voyageId:e.id})}else 4===this.readyState&&401===this.status&&alert("Connection time out. Please reconnect")},r.open("POST","https://wtg.aymerik-diebold.fr/api/trips",!0),r.setRequestHeader("Authorization","Bearer "+i.state.token),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify({title:e,description:t,vegan:a,ecological:n,author:"api/users/"+i.props.connected,keywords:"paris plage"}))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(E,{active:1,token:this.props.token,connected:this.props.connected,connect:this.props.connect}),this.state.startNewVoyage?this.state.chargement?r.a.createElement(N,null):r.a.createElement(x,{token:this.state.token,addMyVoyage:this.addMyVoyage.bind(this)}):r.a.createElement(M,{token:this.state.token,voyageId:this.state.voyageId,name:this.state.name,vegan:this.state.vegan,ecolo:this.state.ecolo,description:this.state.description}))}}]),a}(n.Component),H=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={voyages:[],lat:48.856614,lng:2.3522219,zoom:2},n.loadTrips(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"loadTrips",value:function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&200===this.status&&(e.setState({voyages:JSON.parse(this.response)["hydra:member"]}),console.log(JSON.parse(this.response)))},t.open("GET","https://wtg.aymerik-diebold.fr/api/trips",!0),t.send()}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(E,{active:0,token:this.props.token,connected:this.props.connected,connect:this.props.connect}),r.a.createElement(d.a,{id:"principalMap",center:[this.state.lat,this.state.lng],zoom:this.state.zoom},r.a.createElement(m.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),this.state.voyages.map((function(e){return e.stages.map((function(t){return r.a.createElement(g.a,{position:[t.lng,t.lat]},r.a.createElement(f.a,null,r.a.createElement("h1",null,e.title),r.a.createElement("a",{href:"?show=trip&id="+e.id},"Click here to discover")))}))}))))}}]),a}(n.Component),q=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={email:"",firstname:"",lastname:"",id:"",trips:[],recordedTrips:[]},e.getUserInfo=function(){w.a.get("https://wtg.aymerik-diebold.fr/api/me",{headers:{Authorization:"Bearer "+e.props.token}}).then((function(t){console.log(t),e.setState({email:t.data.email,firstname:t.data.firstName,lastname:t.data.lastName,id:t.data.id,trips:t.data.trips,recordedTrips:t.data.recordedTrips})})).catch((function(e){throw console.log("Not connected"),e}))},e.getTrips=function(){console.log("get trips"),console.log(e.state.trips);for(var t=0;t<e.state.trips.length;t++)w.a.get("https://wtg.aymerik-diebold.fr/api/trips/"+e.state.trips[t].split("/")[3]).then((function(t){console.log(t),e.setState({tripTitles:[].concat(Object(b.a)(e.state.tripTitles),[{id:t.data.id,title:t.data.title}])})})).catch((function(e){throw e}))},e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.getUserInfo()}},{key:"render",value:function(){return r.a.createElement("div",{className:"profile"},r.a.createElement(E,{active:"4",connected:this.props.connected,connect:this.props.connect}),this.props.connected?r.a.createElement("div",{className:"profileContainer",style:I},r.a.createElement("h1",null,"My Profile"),r.a.createElement("h3",{style:{backgroundColor:"inherit"}},"Personal Info"),r.a.createElement("div",{className:"profileBox",style:B},r.a.createElement("div",null,r.a.createElement("p",null,"Email"),r.a.createElement("p",null,"Firstname"),r.a.createElement("p",null,"Lastname")),r.a.createElement("div",null,r.a.createElement("p",null,this.state.email),r.a.createElement("p",null,this.state.firstname),r.a.createElement("p",null,this.state.lastname))),r.a.createElement("div",{style:F},r.a.createElement("div",{className:"my-trips"},r.a.createElement("h3",{style:{backgroundColor:"inherit"}},"My trips"),this.state.trips.map((function(e){return r.a.createElement("p",null,r.a.createElement("a",{href:"?show=trip&id="+e.id},e.title))})),r.a.createElement("a",{href:"?show=save",style:{color:"red"}},"Add trip!")),r.a.createElement("div",{className:"recorded-trips"},r.a.createElement("h3",{style:{backgroundColor:"inherit"}},"Favorite trips"),0!==this.state.recordedTrips.length?this.state.recordedTrips.map((function(e){return r.a.createElement("p",null,r.a.createElement("a",{href:"?show=trip&id="+e.id},e.title))})):r.a.createElement("p",null,"You don't have any favorite trip :(",r.a.createElement("a",{href:"/WaysToGo",style:{display:"block"}},"Browse trips to save your favorite!"))))):r.a.createElement("p",null,"Please log in"))}}]),a}(n.Component),I={textAlign:"center",backgroundColor:"#f3f3f3",width:"50%",margin:"auto"},B={display:"flex",justifyContent:"space-around"},F={display:"flex",justifyContent:"space-around"},Y=q,J=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={city:e.city,title:e.title,keyword:e.keyword,chercher:e.chercher,vegan:e.vegan,ecolo:e.ecolo},n}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{class:"formulaire"},r.a.createElement("div",{class:"partiedetails"},r.a.createElement("p",{class:"partieLabel"},"Title:"),r.a.createElement("input",{required:!0,type:"text",ref:this.state.title,id:"title",name:"title",placeholder:""})),r.a.createElement("div",{class:"partiedetails"},r.a.createElement("p",{class:"partieLabel"},"Keyword:"),r.a.createElement("input",{required:!0,type:"text",ref:this.state.keyword,id:"keyword",name:"keyword",placeholder:"ex. Paris"})),r.a.createElement("div",{class:"partiedetails"},r.a.createElement("p",{class:"partieLabel"},"City:"),r.a.createElement("input",{required:!0,type:"text",ref:this.state.city,id:"rcity",name:"city",placeholder:"ex. Rome"})),r.a.createElement("div",{class:"partiedetails"},r.a.createElement("div",null,r.a.createElement("input",{ref:this.state.vegan,type:"checkbox",id:"voyagevegan",name:"voyagevegan",value:"newsletter"}),r.a.createElement("label",{htmlFor:"voyagevegan"},"Vegan?")),r.a.createElement("div",null,r.a.createElement("input",{ref:this.state.ecolo,type:"checkbox",id:"voyageecolo",name:"voyageecolo",value:"newsletter"}),r.a.createElement("label",{htmlFor:"voyageecolo"},"Environmentally friendly?"))),r.a.createElement("button",{type:"button",class:"boutonsend",onClick:this.state.chercher},"Chercher"))}}]),a}(r.a.Component),P=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={city:e.city,keyword:e.keyword,title:e.title,vegan:e.vegan,ecolo:e.ecolo,voyages:[]},n.loadDoc(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"loadDoc",value:function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&200===this.status&&e.setState({voyages:JSON.parse(this.response)["hydra:member"]})};var a="https://wtg.aymerik-diebold.fr/api/trips?",n=!0;e.state.title.length>0&&(a=a.concat("title=",e.state.title),n=!1),e.state.keyword.length>0&&(n||(a=a.concat("&")),a=a.concat("keywords=",e.state.keyword),n=!1),e.state.city.length>0&&(n||(a=a.concat("&")),a=a.concat("stages.city=",e.state.city),n=!1),e.state.vegan&&(console.log(e.state.vegan,n),n||(a=a.concat("&")),a=a.concat("vegan=true"),n=!1),e.state.ecolo&&(n||(a=a.concat("&")),a=a.concat("ecological=true")),console.log(a),t.open("GET",a,!0),t.send()}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{id:"recherche"},r.a.createElement("h4",null," Results of",r.a.createElement("ul",null,r.a.createElement("li",null,'Title: "',this.state.title,'" '),r.a.createElement("li",null,'Keyword: "',this.state.keyword,'" '),r.a.createElement("li",null,'City: "',this.state.city,'" '),r.a.createElement("li",null,'Vegan: "',this.state.vegan?"True":"",'" '),r.a.createElement("li",null,'Ecological: "',this.state.ecolo?"True":"",'" ')))),r.a.createElement("div",{id:"table"},this.state.voyages.length>0?r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Title"),r.a.createElement("th",null,"Author"),r.a.createElement("th",null,"Description"),r.a.createElement("th",null,"Lien"))),r.a.createElement("tbody",null,this.state.voyages.map((function(e){return r.a.createElement("tr",null,r.a.createElement("td",null,e.title),r.a.createElement("td",null,e.author.firstName," ",e.author.lastNqme),r.a.createElement("td",null,e.description),r.a.createElement("td",null,r.a.createElement("a",{href:"?show=trip&id="+e.id},"Cliquez")))})))):r.a.createElement("div",null,r.a.createElement("p",null,"Not found"),r.a.createElement("a",{href:"?show=research"},"Return"))))}}]),a}(r.a.Component),z=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={id:e.id,startNewSearch:!0,vegan:!1,ecolo:!1,toRender:r.a.createElement("h1",null,"Chargement en cours...")},n.city=r.a.createRef(),n.title=r.a.createRef(),n.keyword=r.a.createRef(),n.vegan=r.a.createRef(),n.ecolo=r.a.createRef(),n.chercher=n.chercher.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"chercher",value:function(){this.city.current.validity.valid||this.title.current.validity.valid||this.keyword.current.validity.valid?this.setState({city:this.city.current.value,keyword:this.keyword.current.value,title:this.title.current.value,vegan:this.vegan.current.checked,ecolo:this.ecolo.current.checked,startNewSearch:!1}):alert("Veillez completer au moins un champ pour chercher")}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(E,{active:"5"}),this.state.startNewSearch?r.a.createElement(J,{city:this.city,title:this.title,keyword:this.keyword,vegan:this.vegan,ecolo:this.ecolo,chercher:this.chercher}):r.a.createElement(P,{city:this.city.current.value,title:this.title.current.value,keyword:this.keyword.current.value,vegan:this.vegan.current.checked,ecolo:this.ecolo.current.checked}))}}]),a}(n.Component),K=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(E,{active:3,token:this.props.token,connected:this.props.connected,connect:this.props.connect}),r.a.createElement("h2",null,"WaysToGo"),r.a.createElement("h3",null,"Explore. Share. Discover."),r.a.createElement("p",null,"WaysToGo allows you to share your trips to everyone. ",r.a.createElement("br",null),"Search new trips, begin new adventures :)"),r.a.createElement("p",null,"Founded by Caroline Texier and Arnaud Stoffel"),r.a.createElement("p",null,"Developed by Aymerik Diebold, Jiacheng Zhou, L\xe9on Davidovski, Youssef El Saadany with \u2665"),r.a.createElement("br",null),r.a.createElement("p",null,"Developed with React and Symfony. Photos hosted by Imgur.com. Powered by Nominatim from OpenStreetMap."))}}]),a}(n.Component),V=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(o.a)(this,a),(n=t.call(this,e)).connect=function(e){console.log("Connected!"),n.setState({connected:!0,token:e}),(new u.a).set("token",e,{path:"/"})},n.disconnect=function(){(new u.a).remove("token",{path:"/"}),n.setState({connected:!1,token:""}),console.log("Disconnected")};var r=new u.a,i=new URLSearchParams(window.location.search),s=!!r.get("token")&&r.get("token");return i.get("logout")&&(n.disconnect(),s=!1),n.state={pageActuelle:i.get("show"),trip:i.get("id"),connected:!!s,token:s||""},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.state.token&&(console.log("Connected!"),w.a.get("https://wtg.aymerik-diebold.fr/api/me",{headers:{Authorization:"Bearer "+this.state.token}}).then((function(t){e.setState({connected:t.data.id})})).catch((function(t){throw console.log("wut"),console.log(e.state.token),e.setState({connected:!1,token:""}),(new u.a).remove("token",{path:"/"}),t})))}},{key:"render",value:function(){return"trip"===this.state.pageActuelle?r.a.createElement(L,{id:this.state.trip,connected:this.state.connected,connect:this.connect,token:this.state.token}):"save"===this.state.pageActuelle?r.a.createElement(A,{token:this.state.token,connected:this.state.connected,connect:this.connect}):"profile"===this.state.pageActuelle?r.a.createElement(Y,{connected:this.state.connected,token:this.state.token,connect:this.connect}):"research"===this.state.pageActuelle?r.a.createElement(z,null):"about"===this.state.pageActuelle?r.a.createElement(K,{token:this.state.token,connected:this.state.connected,connect:this.connect}):r.a.createElement(H,{connected:this.state.connected,connect:this.connect})}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(V,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[35,1,2]]]);
//# sourceMappingURL=main.f6e48a4e.chunk.js.map